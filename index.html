<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <title>Trening ‚Äì 3 dru≈ºyny + tabela</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:rgba(16,26,46,.78);
      --text:#e9eefc;
      --muted:#9aa7c2;
      --border:rgba(255,255,255,.12);
      --shadow:0 12px 30px rgba(0,0,0,.35);
      --r:16px;

      --yellow:#ffd400;
      --orange:#ff7a00;
      --purple:#a855f7;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1000px 480px at 20% 10%, rgba(255,255,255,.08), transparent),
                  radial-gradient(900px 420px at 80% 20%, rgba(255,255,255,.06), transparent),
                  var(--bg);
      padding:14px;
    }
    .wrap{max-width:1100px;margin:0 auto;display:grid;gap:12px}
    header{
      background:linear-gradient(to bottom, rgba(11,18,32,.92), rgba(11,18,32,.65));
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:12px 14px;
      position:sticky; top:0; z-index:5;
      backdrop-filter: blur(10px);
    }
    h1{margin:0;font-size:18px}
    .sub{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.35}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .tab{
      border:1px solid var(--border);
      background:#162446;
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      font-weight:800;
      cursor:pointer;
      font-size:13px;
    }
    .tab.active{background:#22345f}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:980px){.grid{grid-template-columns:420px 1fr}}

    .panel{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
      backdrop-filter: blur(8px);
    }

    textarea{
      width:100%; min-height:160px; resize:vertical;
      border-radius:14px;
      border:1px solid var(--border);
      background:#0b1427;
      color:var(--text);
      padding:12px;
      outline:none;
      font-size:14px;
      line-height:1.35;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{
      border:1px solid var(--border);
      background:#162446;
      color:var(--text);
      padding:12px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      font-size:14px;
      touch-action:manipulation;
    }
    button.secondary{background:#0f1b35}
    button.danger{background:#3a1630}
    button:disabled{opacity:.55;cursor:not-allowed}

    .status{margin-top:10px;font-size:13px;color:var(--muted)}

    .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.12);
      font-size:13px
    }
    .dot{width:10px;height:10px;border-radius:99px;display:inline-block}
    .dot.yellow{background:var(--yellow)}
    .dot.orange{background:var(--orange)}
    .dot.purple{background:var(--purple)}

    .cardsHead{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-bottom:10px}
    .counter{font-size:13px;color:var(--muted)}
    .cards{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:520px){.cards{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:900px){.cards{grid-template-columns:repeat(3,minmax(0,1fr))}}

    .cardBtn{
      width:100%; text-align:left;
      padding:14px;
      border-radius:16px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.18);
      box-shadow:0 8px 18px rgba(0,0,0,.25);
      cursor:pointer;
      min-height:78px;
      position:relative; overflow:hidden;
    }
    .name{font-weight:1000;font-size:15px;margin-bottom:6px}
    .hint{font-size:12px;color:rgba(233,238,252,.55)}
    .reveal{display:none;margin-top:6px;font-weight:1000;padding:7px 10px;border-radius:999px;width:max-content;font-size:12px;border:1px solid rgba(255,255,255,.16)}
    .reveal.yellow{background:rgba(255,212,0,.18)}
    .reveal.orange{background:rgba(255,122,0,.18)}
    .reveal.purple{background:rgba(168,85,247,.18)}
    .cardBtn.revealed .hint{display:none}
    .cardBtn.revealed .reveal{display:inline-flex}
    .cardBtn::after{
      content:""; position:absolute; inset:auto -90px -90px auto;
      width:200px;height:200px;
      background:radial-gradient(circle at 30% 30%, rgba(255,255,255,.18), transparent 60%);
      transform:rotate(25deg);
      pointer-events:none;
    }

    .split{display:none}
    .split.show{display:block}

    /* RESULTS */
    .formRow{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:700px){.formRow{grid-template-columns: 1fr 1fr 1fr 1fr auto}}
    select, input{
      border-radius:14px;
      border:1px solid var(--border);
      background:#0b1427;
      color:var(--text);
      padding:12px;
      outline:none;
      font-size:14px;
    }
    input{width:100%}

    table{
      width:100%;
      border-collapse:collapse;
      overflow:hidden;
      border-radius:16px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.18);
      margin-top:12px;
    }
    thead th{
      text-align:left;
      padding:10px;
      font-size:13px;
      border-bottom:1px solid var(--border);
      color:#fff;
    }
    tbody td{
      padding:9px 10px;
      font-size:13px;
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    tbody tr:last-child td{border-bottom:none}
    .small{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.35}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.12);
      font-size:13px
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Trening ‚Äì 3 dru≈ºyny + tabela</h1>
      <div class="sub">Losowanie do ≈ª√≥≈Çtych / Pomara≈Ñczowych / Fioletowych + wpisywanie wynik√≥w i automatyczna tabela.</div>
      <div class="tabs">
        <button class="tab active" id="tabDraw">Losowanie</button>
        <button class="tab" id="tabResults">Wyniki & tabela</button>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT -->
      <div class="panel">
        <!-- LOSOWANIE -->
        <div id="viewDraw" class="split show">
          <div style="font-weight:900;font-size:14px;margin-bottom:8px;">Zawodnicy (1 linia = 1 osoba)</div>
          <textarea id="players" placeholder="np.
Tomek
Kuba
Mati
Bartek
..."></textarea>

          <div class="legend">
            <span class="chip"><span class="dot yellow"></span> ≈ª√≥≈Çci</span>
            <span class="chip"><span class="dot orange"></span> Pomara≈Ñczowi</span>
            <span class="chip"><span class="dot purple"></span> Fioletowi</span>
          </div>

          <div class="row">
            <button id="drawBtn">Losuj sk≈Çady</button>
            <button id="reshuffleBtn" class="secondary" disabled>Wymieszaj ponownie</button>
            <button id="saveTeamsBtn" class="secondary" disabled>Zapisz do tabeli</button>
            <button id="resetBtn" class="danger">Reset</button>
          </div>

          <div class="status" id="statusDraw">Wpisz zawodnik√≥w i losuj.</div>
          <div class="small">
            Tip: ‚ÄûZapisz do tabeli‚Äù zapisuje sk≈Çady do pamiƒôci, ≈ºeby≈õ widzia≈Ç je te≈º w zak≈Çadce Wyniki.
          </div>
        </div>

        <!-- WYNIKI -->
        <div id="viewResults" class="split">
          <div style="font-weight:900;font-size:14px;margin-bottom:8px;">Dodaj wynik meczu</div>

          <div class="formRow">
            <select id="teamA"></select>
            <input id="goalsA" type="number" min="0" inputmode="numeric" placeholder="gole A" />
            <select id="teamB"></select>
            <input id="goalsB" type="number" min="0" inputmode="numeric" placeholder="gole B" />
            <button id="addMatchBtn">Dodaj</button>
          </div>

          <div class="row" style="margin-top:10px;">
            <button id="undoBtn" class="secondary" disabled>Cofnij ostatni</button>
            <button id="clearMatchesBtn" class="danger">Wyczy≈õƒá wyniki</button>
          </div>

          <div class="status" id="statusRes">Wpisz wynik i kliknij ‚ÄûDodaj‚Äù.</div>
          <div class="small">
            Punkty: zwyciƒôstwo 3, remis 1, pora≈ºka 0. Tabela liczy M/Z/R/P, bramki, r√≥≈ºnicƒô i punkty.
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="panel">
        <!-- LOSOWANIE: karty + tabelki sk≈Çad√≥w -->
        <div id="rightDraw" class="split show">
          <div class="cardsHead">
            <div style="font-weight:1000;">Zakryte okienka</div>
            <div class="counter" id="counter">Odkryte: 0 / 0</div>
          </div>
          <div class="cards" id="cards"></div>

          <div id="teamsPreview" style="display:none;margin-top:14px;gap:12px;">
            <div class="pill"><span class="dot purple"></span><b>Fioletowi:</b> <span id="listPurple"></span></div>
            <div class="pill"><span class="dot yellow"></span><b>≈ª√≥≈Çci:</b> <span id="listYellow"></span></div>
            <div class="pill"><span class="dot orange"></span><b>Pomara≈Ñczowi:</b> <span id="listOrange"></span></div>
          </div>
        </div>

        <!-- WYNIKI: tabela + lista mecz√≥w -->
        <div id="rightResults" class="split">
          <div style="font-weight:1000;">Tabela</div>
          <table>
            <thead>
              <tr>
                <th>Dru≈ºyna</th><th>M</th><th>Z</th><th>R</th><th>P</th><th>Bramki</th><th>+/-</th><th>Pkt</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>

          <div style="margin-top:14px;font-weight:1000;">Mecze</div>
          <table>
            <thead>
              <tr><th>#</th><th>Mecz</th><th>Wynik</th></tr>
            </thead>
            <tbody id="matchesBody"></tbody>
          </table>

          <div class="small" id="teamsHint"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  // --- Tabs ---
  const tabDraw = document.getElementById("tabDraw");
  const tabResults = document.getElementById("tabResults");
  const viewDraw = document.getElementById("viewDraw");
  const viewResults = document.getElementById("viewResults");
  const rightDraw = document.getElementById("rightDraw");
  const rightResults = document.getElementById("rightResults");

  function showTab(which){
    const drawOn = which === "draw";
    tabDraw.classList.toggle("active", drawOn);
    tabResults.classList.toggle("active", !drawOn);
    viewDraw.classList.toggle("show", drawOn);
    rightDraw.classList.toggle("show", drawOn);
    viewResults.classList.toggle("show", !drawOn);
    rightResults.classList.toggle("show", !drawOn);
    if(!drawOn) renderAllTables();
  }

  tabDraw.addEventListener("click", () => showTab("draw"));
  tabResults.addEventListener("click", () => showTab("results"));

  // --- Teams constants ---
  const TEAMS = [
    { key:"yellow", name:"≈ª√≥≈Çci", color:"yellow" },
    { key:"orange", name:"Pomara≈Ñczowi", color:"orange" },
    { key:"purple", name:"Fioletowi", color:"purple" },
  ];

  // --- LOSOWANIE ---
  const elPlayers = document.getElementById("players");
  const elCards = document.getElementById("cards");
  const elStatusDraw = document.getElementById("statusDraw");
  const elCounter = document.getElementById("counter");
  const drawBtn = document.getElementById("drawBtn");
  const reshuffleBtn = document.getElementById("reshuffleBtn");
  const saveTeamsBtn = document.getElementById("saveTeamsBtn");
  const resetBtn = document.getElementById("resetBtn");

  const teamsPreview = document.getElementById("teamsPreview");
  const listPurple = document.getElementById("listPurple");
  const listYellow = document.getElementById("listYellow");
  const listOrange = document.getElementById("listOrange");

  let assignments = []; // {name, teamKey}
  let revealedCount = 0;

  function sanitizeNames(raw){
    return raw.split("\n").map(s=>s.trim()).filter(Boolean).filter((v,i,a)=>a.indexOf(v)===i);
  }
  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }
  function assignTeams(names){
    const list = shuffle([...names]);
    return list.map((name,idx)=>({name, teamKey: TEAMS[idx%3].key}));
  }
  function teamByKey(key){ return TEAMS.find(t=>t.key===key); }
  function setDrawStatus(msg){ elStatusDraw.textContent = msg; }
  function updateCounter(){ elCounter.textContent = `Odkryte: ${revealedCount} / ${assignments.length}`; }
  function escapeHtml(str){
    return str.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }

  function renderTeamsPreview(){
    const groups = {yellow:[], orange:[], purple:[]};
    assignments.forEach(a=>groups[a.teamKey].push(a.name));
    Object.keys(groups).forEach(k=>groups[k].sort((a,b)=>a.localeCompare(b,"pl")));

    listPurple.textContent = groups.purple.join(", ");
    listYellow.textContent = groups.yellow.join(", ");
    listOrange.textContent = groups.orange.join(", ");

    teamsPreview.style.display = "grid";
  }

  function renderCards(){
    elCards.innerHTML = "";
    teamsPreview.style.display = "none";
    revealedCount = 0;
    updateCounter();
    saveTeamsBtn.disabled = true;

    assignments.forEach((a)=>{
      const team = teamByKey(a.teamKey);
      const btn = document.createElement("button");
      btn.className = "cardBtn";
      btn.type = "button";
      btn.dataset.revealed = "0";
      btn.innerHTML = `
        <div class="name">${escapeHtml(a.name)}</div>
        <div class="hint">Kliknij, ≈ºeby odkryƒá dru≈ºynƒô</div>
        <div class="reveal ${team.color}">Dru≈ºyna: ${team.name}</div>
      `;
      btn.addEventListener("click", ()=>{
        if(btn.dataset.revealed==="1") return;
        btn.dataset.revealed="1";
        btn.classList.add("revealed");
        revealedCount++;
        updateCounter();
        if(revealedCount===assignments.length){
          setDrawStatus("Wszyscy odkryli przydzia≈Ç ‚úÖ");
          renderTeamsPreview();
          saveTeamsBtn.disabled = false;
        } else {
          setDrawStatus("Odkrywajcie dalej üôÇ");
        }
      });
      elCards.appendChild(btn);
    });

    setDrawStatus("Gotowe. Ka≈ºdy klika swoje okienko.");
  }

  drawBtn.addEventListener("click", ()=>{
    const names = sanitizeNames(elPlayers.value);
    if(names.length<3){ setDrawStatus("Dodaj minimum 3 zawodnik√≥w (po 1 w linii)."); return; }
    assignments = assignTeams(names);
    renderCards();
    reshuffleBtn.disabled = false;
    localStorage.setItem("players", elPlayers.value);
  });

  reshuffleBtn.addEventListener("click", ()=>{
    if(!assignments.length) return;
    const names = assignments.map(a=>a.name);
    assignments = assignTeams(names);
    renderCards();
  });

  resetBtn.addEventListener("click", ()=>{
    assignments = [];
    revealedCount = 0;
    elCards.innerHTML = "";
    teamsPreview.style.display = "none";
    reshuffleBtn.disabled = true;
    saveTeamsBtn.disabled = true;
    updateCounter();
    setDrawStatus("Wpisz zawodnik√≥w i losuj.");
  });

  // --- WYNIKI & TABELA ---
  const teamA = document.getElementById("teamA");
  const teamB = document.getElementById("teamB");
  const goalsA = document.getElementById("goalsA");
  const goalsB = document.getElementById("goalsB");
  const addMatchBtn = document.getElementById("addMatchBtn");
  const undoBtn = document.getElementById("undoBtn");
  const clearMatchesBtn = document.getElementById("clearMatchesBtn");
  const statusRes = document.getElementById("statusRes");
  const tableBody = document.getElementById("tableBody");
  const matchesBody = document.getElementById("matchesBody");
  const teamsHint = document.getElementById("teamsHint");

  let matches = []; // {aKey,bKey,ga,gb}

  function setResStatus(msg){ statusRes.textContent = msg; }

  function loadSaved(){
    const savedPlayers = localStorage.getItem("players");
    if(savedPlayers) elPlayers.value = savedPlayers;

    const savedTeams = localStorage.getItem("teams_last");
    if(savedTeams){
      // just for hint
      teamsHint.textContent = "Masz zapisane sk≈Çady z losowania. Wyniki liczƒÖ siƒô niezale≈ºnie od sk≈Çad√≥w (to tabela dru≈ºyn).";
    } else {
      teamsHint.textContent = "Tip: w zak≈Çadce Losowanie kliknij ‚ÄûZapisz do tabeli‚Äù, ≈ºeby zachowaƒá sk≈Çady na trening.";
    }

    const savedMatches = localStorage.getItem("matches");
    if(savedMatches){
      try { matches = JSON.parse(savedMatches) || []; } catch { matches=[]; }
    }
    fillTeamSelects();
    renderAllTables();
  }

  function fillTeamSelects(){
    const opts = TEAMS.map(t=>`<option value="${t.key}">${t.name}</option>`).join("");
    teamA.innerHTML = opts;
    teamB.innerHTML = opts;
    teamA.value = "orange";
    teamB.value = "purple";
  }

  function saveMatches(){
    localStorage.setItem("matches", JSON.stringify(matches));
    undoBtn.disabled = matches.length === 0;
  }

  function computeTable(){
    const stats = {};
    TEAMS.forEach(t=>{
      stats[t.key] = { key:t.key, name:t.name, M:0,Z:0,R:0,P:0,GF:0,GA:0,Pkt:0 };
    });

    for(const m of matches){
      const A = stats[m.aKey];
      const B = stats[m.bKey];
      A.M++; B.M++;
      A.GF += m.ga; A.GA += m.gb;
      B.GF += m.gb; B.GA += m.ga;

      if(m.ga > m.gb){
        A.Z++; B.P++; A.Pkt += 3;
      } else if(m.ga < m.gb){
        B.Z++; A.P++; B.Pkt += 3;
      } else {
        A.R++; B.R++; A.Pkt += 1; B.Pkt += 1;
      }
    }

    const rows = Object.values(stats).map(s=>{
      return {...s, GD: s.GF - s.GA, goals:`${s.GF}-${s.GA}`};
    });

    // sort: Pkt desc, GD desc, GF desc, name asc
    rows.sort((x,y)=>{
      if(y.Pkt !== x.Pkt) return y.Pkt - x.Pkt;
      if(y.GD !== x.GD) return y.GD - x.GD;
      if(y.GF !== x.GF) return y.GF - x.GF;
      return x.name.localeCompare(y.name,"pl");
    });

    return rows;
  }

  function renderAllTables(){
    // table
    const rows = computeTable();
    tableBody.innerHTML = "";
    for(const r of rows){
      tableBody.insertAdjacentHTML("beforeend", `
        <tr>
          <td><b>${escapeHtml(r.name)}</b></td>
          <td>${r.M}</td><td>${r.Z}</td><td>${r.R}</td><td>${r.P}</td>
          <td>${r.goals}</td><td>${r.GD}</td><td><b>${r.Pkt}</b></td>
        </tr>
      `);
    }

    // matches list
    matchesBody.innerHTML = "";
    matches.forEach((m,i)=>{
      const A = teamByKey(m.aKey).name;
      const B = teamByKey(m.bKey).name;
      matchesBody.insertAdjacentHTML("beforeend", `
        <tr>
          <td>${i+1}</td>
          <td>${escapeHtml(A)} ‚Äì ${escapeHtml(B)}</td>
          <td><b>${m.ga}:${m.gb}</b></td>
        </tr>
      `);
    });

    undoBtn.disabled = matches.length === 0;
  }

  addMatchBtn.addEventListener("click", ()=>{
    const aKey = teamA.value;
    const bKey = teamB.value;
    const ga = Number(goalsA.value);
    const gb = Number(goalsB.value);

    if(aKey === bKey){ setResStatus("Wybierz dwie r√≥≈ºne dru≈ºyny."); return; }
    if(!Number.isFinite(ga) || !Number.isFinite(gb) || ga<0 || gb<0){ setResStatus("Podaj poprawne gole (0 lub wiƒôcej)."); return; }

    matches.push({aKey,bKey,ga,gb});
    goalsA.value = ""; goalsB.value = "";
    setResStatus("Dodano wynik ‚úÖ");
    saveMatches();
    renderAllTables();
  });

  undoBtn.addEventListener("click", ()=>{
    if(!matches.length) return;
    matches.pop();
    setResStatus("Cofniƒôto ostatni 
