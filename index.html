<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <title>Trening – losowanie 3 składy</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:rgba(16,26,46,.78);
      --text:#e9eefc;
      --muted:#9aa7c2;
      --border:rgba(255,255,255,.12);
      --shadow:0 12px 30px rgba(0,0,0,.35);
      --r:16px;

      --yellow:#ffd400;
      --orange:#ff7a00;
      --purple:#a855f7;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1000px 480px at 20% 10%, rgba(255,255,255,.08), transparent),
                  radial-gradient(900px 420px at 80% 20%, rgba(255,255,255,.06), transparent),
                  var(--bg);
      padding:14px;
    }
    .wrap{max-width:1100px;margin:0 auto;display:grid;gap:12px}
    header{
      background:linear-gradient(to bottom, rgba(11,18,32,.92), rgba(11,18,32,.65));
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:12px 14px;
      position:sticky; top:0; z-index:5;
      backdrop-filter: blur(10px);
    }
    h1{margin:0;font-size:18px}
    .sub{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.35}

    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:980px){.grid{grid-template-columns:420px 1fr}}

    .panel{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
      backdrop-filter: blur(8px);
    }

    textarea{
      width:100%; min-height:200px; resize:vertical;
      border-radius:14px;
      border:1px solid var(--border);
      background:#0b1427;
      color:var(--text);
      padding:12px;
      outline:none;
      font-size:14px;
      line-height:1.35;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{
      border:1px solid var(--border);
      background:#162446;
      color:var(--text);
      padding:12px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      font-size:14px;
      touch-action:manipulation;
    }
    button.secondary{background:#0f1b35}
    button.danger{background:#3a1630}
    .status{margin-top:10px;font-size:13px;color:var(--muted)}

    .teams{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
    @media(min-width:720px){.teams{grid-template-columns:repeat(3,1fr)}}

    .teamCard{
      border:1px solid var(--border);
      border-radius:16px;
      background:rgba(0,0,0,.18);
      padding:12px;
      box-shadow:0 8px 18px rgba(0,0,0,.25);
      min-height:240px;
    }
    .teamTitle{
      display:flex; align-items:center; gap:10px;
      font-weight:1000;
      margin-bottom:10px;
    }
    .dot{width:12px;height:12px;border-radius:99px;display:inline-block}
    .dot.yellow{background:var(--yellow)}
    .dot.orange{background:var(--orange)}
    .dot.purple{background:var(--purple)}
    .count{margin-left:auto;color:var(--muted);font-size:12px;font-weight:800}

    ul{margin:0;padding-left:18px}
    li{margin:6px 0}
    .small{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.35}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Trening – losowanie 3 składy</h1>
      <div class="sub">Wpisujesz zawodników → „Losuj równo” → wyświetla 3 składy (Żółci / Pomarańczowi / Fioletowi).</div>
    </header>

    <div class="grid">
      <div class="panel">
        <div style="font-weight:900;font-size:14px;margin-bottom:8px;">Zawodnicy (1 linia = 1 osoba)</div>
        <textarea id="players" placeholder="np.
Tomek
Kuba
Mati
Bartek
..."></textarea>

        <div class="row">
          <button id="drawBtn">Losuj równo</button>
          <button id="reshuffleBtn" class="secondary" disabled>Losuj jeszcze raz</button>
          <button id="copyBtn" class="secondary" disabled>Kopiuj składy</button>
          <button id="resetBtn" class="danger">Reset</button>
        </div>

        <div class="status" id="status">Wpisz zawodników i kliknij „Losuj równo”.</div>
        <div class="small">
          Zasada: rozdzielam po kolei do 3 drużyn po wymieszaniu listy (różnica max 1 osoba).
        </div>
      </div>

      <div class="panel">
        <div class="teams">
          <div class="teamCard">
            <div class="teamTitle"><span class="dot yellow"></span> Żółci <span class="count" id="cYellow">0</span></div>
            <ul id="listYellow"></ul>
          </div>
          <div class="teamCard">
            <div class="teamTitle"><span class="dot orange"></span> Pomarańczowi <span class="count" id="cOrange">0</span></div>
            <ul id="listOrange"></ul>
          </div>
          <div class="teamCard">
            <div class="teamTitle"><span class="dot purple"></span> Fioletowi <span class="count" id="cPurple">0</span></div>
            <ul id="listPurple"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  const elPlayers = document.getElementById("players");
  const drawBtn = document.getElementById("drawBtn");
  const reshuffleBtn = document.getElementById("reshuffleBtn");
  const copyBtn = document.getElementById("copyBtn");
  const resetBtn = document.getElementById("resetBtn");
  const statusEl = document.getElementById("status");

  const listYellow = document.getElementById("listYellow");
  const listOrange = document.getElementById("listOrange");
  const listPurple = document.getElementById("listPurple");

  const cYellow = document.getElementById("cYellow");
  const cOrange = document.getElementById("cOrange");
  const cPurple = document.getElementById("cPurple");

  let lastTeams = null;

  function sanitizeNames(raw){
    return raw.split("\n")
      .map(s=>s.trim())
      .filter(Boolean)
      .filter((v,i,a)=>a.indexOf(v)===i); // usuń duplikaty
  }
  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }
  function renderList(el, names){
    el.innerHTML = names.map(n => `<li>${escapeHtml(n)}</li>`).join("");
  }
  function escapeHtml(str){
    return str.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }

  function drawTeams(){
    const names = sanitizeNames(elPlayers.value);
    if(names.length < 3){
      statusEl.textContent = "Dodaj minimum 3 zawodników (po 1 w linii).";
      return null;
    }
    const mixed = shuffle([...names]);
    const yellow = [], orange = [], purple = [];
    mixed.forEach((name, idx) => {
      const m = idx % 3;
      if(m === 0) yellow.push(name);
      if(m === 1) orange.push(name);
      if(m === 2) purple.push(name);
    });

    // dla estetyki: sort w środku składu
    yellow.sort((a,b)=>a.localeCompare(b,"pl"));
    orange.sort((a,b)=>a.localeCompare(b,"pl"));
    purple.sort((a,b)=>a.localeCompare(b,"pl"));

    renderList(listYellow, yellow);
    renderList(listOrange, orange);
    renderList(listPurple, purple);

    cYellow.textContent = yellow.length;
    cOrange.textContent = orange.length;
    cPurple.textContent = purple.length;

    statusEl.textContent = "Wylosowano ✅";
    reshuffleBtn.disabled = false;
    copyBtn.disabled = false;

    lastTeams = {yellow, orange, purple};
    localStorage.setItem("players_simple", elPlayers.value);
    localStorage.setItem("teams_simple", JSON.stringify(lastTeams));
    return lastTeams;
  }

  drawBtn.addEventListener("click", drawTeams);
  reshuffleBtn.addEventListener("click", drawTeams);

  copyBtn.addEventListener("click", async ()=>{
    if(!lastTeams){ statusEl.textContent = "Najpierw wylosuj składy."; return; }
    const text =
`Żółci (${lastTeams.yellow.length}):
- ${lastTeams.yellow.join("\n- ")}

Pomarańczowi (${lastTeams.orange.length}):
- ${lastTeams.orange.join("\n- ")}

Fioletowi (${lastTeams.purple.length}):
- ${lastTeams.purple.join("\n- ")}`;
    try{
      await navigator.clipboard.writeText(text);
      statusEl.textContent = "Składy skopiowane do schowka ✅";
    }catch(e){
      statusEl.textContent = "Nie mogę skopiować (ograniczenia przeglądarki). Zrób screenshot albo skopiuj ręcznie.";
    }
  });

  resetBtn.addEventListener("click", ()=>{
    elPlayers.value = "";
    listYellow.innerHTML = "";
    listOrange.innerHTML = "";
    listPurple.innerHTML = "";
    cYellow.textContent = cOrange.textContent = cPurple.textContent = "0";
    statusEl.textContent = "Wpisz zawodników i kliknij „Losuj równo”.";
    reshuffleBtn.disabled = true;
    copyBtn.disabled = true;
    lastTeams = null;
    localStorage.removeItem("players_simple");
    localStorage.removeItem("teams_simple");
  });

  // load saved
  (function(){
    const saved = localStorage.getItem("players_simple");
    if(saved) elPlayers.value = saved;
    const savedTeams = localStorage.getItem("teams_simple");
    if(savedTeams){
      try{
        lastTeams = JSON.parse(savedTeams);
        renderList(listYellow, lastTeams.yellow || []);
        renderList(listOrange, lastTeams.orange || []);
        renderList(listPurple, lastTeams.purple || []);
        cYellow.textContent = (lastTeams.yellow||[]).length;
        cOrange.textContent = (lastTeams.orange||[]).length;
        cPurple.textContent = (lastTeams.purple||[]).length;
        reshuffleBtn.disabled = false;
        copyBtn.disabled = false;
        statusEl.textContent = "Wczytano poprzednie losowanie ✅";
      }catch{}
    }
  })();
</script>
</body>
</html>
